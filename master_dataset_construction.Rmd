---
title: "master_dataset_construction"
author: "Owen Liu"
date: "May 12, 2016"
output: html_document
---
## Combining Nutritional, Ecological, and Economic Datasets to produce a "Master" global mariculture dataset

The idea is to produce two different datasets, one organized by species with their associated nutritional, ecological, and economic data, and one organized by countries, with their associated nutritional/poverty status, ecological scores, and economic parameters


```{r dataset importing}
library(plyr)
library(dplyr)

# Working directory
W_D <- getwd() # Owen's working directory where all the scripts are.  Data files are in this wd/data

# Renato's value, aquaculture production, and world trade datasets
value <- read.csv(file=paste0(W_D,"/data/WORLD_VALUE.csv"))
prod <- read.csv(file=paste0(W_D,"/data/WORLD_AQ_PRODUCTION.csv"))
trade <- read.csv(file=paste0(W_D,"/data/WORLD_TRADE.csv"))

# Trujillo ecological data
# By country
truj.coun <- read.csv(file=paste0(W_D,"/data/trujillo_countries.csv"))
# Fix the names (for descriptions of variables, see Trujillo 2008 in Alder and Pauly, 2008)
names(truj.coun) <- c("country","native","ex.imp","fishmeal","intensity","nutri","hatchery","antibiotic","habitat","GMO","code","trace","employment","waste")

# By species
truj.spe <- read.csv(file=paste0(W_D,"/data/trujillo_species.csv"))
# Fix the names
names(truj.spe) <- c("country","species","native","fishmeal","intensity","hatchery","habitat","waste","ecol.score","msi")

# Nutritional status by country
foodsecurity <- read.csv(file=paste0(W_D,"/data/Food Security Data/FOODSECURITY.csv"))
```

Now we can join the various data sets into two Master datasets; one organized by country/year/species for species-specific variables, and one by country/year for country-specific (non species-specific) variables

```{r join data}
# Join value and production data and remove ID columns
econ <- full_join(value,prod,by=c("species","year","country","area"))
econ <- econ[,-c(1,9)]

# Join Trujillo species data to econ dataset
spe.data <- full_join(econ,truj.spe,by=c("country","species"))

# Join nutritional status data to trade and Trujillo country data and remove excess columns
coun.data <- full_join(trade,foodsecurity,by=c("country","year"))
coun.data <- coun.data[,-c(1,11)]
coun.data <- full_join(coun.data,truj.coun,by="country")

# Save data
write.csv(spe.data,file=paste0(W_D,"/data/species_data_full.csv"))
write.csv(coun.data,file=paste0(W_D,"/data/country_data_full.csv"))

```